import { db } from "../server/db";
import { categories, menuItems, blogPosts, users } from "../shared/schema";

async function seedData() {
  console.log("üå± Seeding database with sample data...");

  try {
    // Clear existing data
    await db.delete(menuItems);
    await db.delete(blogPosts);
    await db.delete(categories);

    // Insert categories
    const categoryData = [
      {
        name: "Appetizers",
        nameVi: "M√≥n Khai V·ªã",
        description: "Start your culinary journey with our exquisite appetizers",
        sortOrder: 1,
      },
      {
        name: "Main Courses",
        nameVi: "M√≥n Ch√≠nh",
        description: "Signature dishes that showcase Vietnamese culinary artistry",
        sortOrder: 2,
      },
      {
        name: "Desserts",
        nameVi: "M√≥n Tr√°ng Mi·ªáng",
        description: "Sweet endings to your dining experience",
        sortOrder: 3,
      },
      {
        name: "Tea Selection",
        nameVi: "Tr√† Cao C·∫•p",
        description: "Premium Vietnamese and international teas",
        sortOrder: 4,
      },
    ];

    const insertedCategories = await db.insert(categories).values(categoryData).returning();
    console.log("‚úÖ Categories seeded successfully");

    // Insert menu items
    const menuItemsData = [
      // Appetizers
      {
        name: "Golden Spring Rolls",
        nameVi: "Ch·∫£ Gi√≤ V√†ng",
        description: "Crispy spring rolls filled with shrimp, pork, and vegetables, served with nuoc cham dipping sauce",
        descriptionVi: "Ch·∫£ gi√≤ gi√≤n tan v·ªõi t√¥m, th·ªãt heo v√† rau c·ªß, k√®m n∆∞·ªõc ch·∫•m truy·ªÅn th·ªëng",
        price: "18.00",
        imageUrl: "https://images.unsplash.com/photo-1563379091339-03246963d675?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[0].id,
        isAvailable: true,
        tags: ["signature", "crispy", "traditional"],
      },
      {
        name: "Fresh Summer Rolls",
        nameVi: "G·ªèi Cu·ªën T∆∞∆°i",
        description: "Delicate rice paper rolls with prawns, herbs, and vermicelli, served with peanut dipping sauce",
        descriptionVi: "B√°nh tr√°ng cu·ªën t√¥m th·ªãt v·ªõi rau th∆°m t∆∞∆°i, k√®m n∆∞·ªõc ch·∫•m ƒë·∫≠u ph·ªông",
        price: "16.00",
        imageUrl: "https://images.unsplash.com/photo-1559847844-d721426d6edc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[0].id,
        isAvailable: true,
        tags: ["fresh", "healthy", "gluten-free"],
      },
      {
        name: "Beef Carpaccio Vietnamese Style",
        nameVi: "Th·ªãt B√≤ T√°i Ki·ªÉu Vi·ªát",
        description: "Thinly sliced beef with Vietnamese herbs, peanuts, and lime dressing",
        descriptionVi: "Th·ªãt b√≤ th√°i m·ªèng v·ªõi rau th∆°m Vi·ªát Nam, ƒë·∫≠u ph·ªông v√† n∆∞·ªõc m·∫Øm chanh",
        price: "22.00",
        imageUrl: "https://images.unsplash.com/photo-1559847844-5315695dadae?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[0].id,
        isAvailable: true,
        tags: ["premium", "raw", "herbs"],
      },

      // Main Courses
      {
        name: "Pho Bo Premium",
        nameVi: "Ph·ªü B√≤ ƒê·∫∑c Bi·ªát",
        description: "Aromatic beef pho with wagyu slices, bone marrow, and 24-hour slow-cooked broth",
        descriptionVi: "Ph·ªü b√≤ th∆°m n·ª©c v·ªõi th·ªãt wagyu, t·ªßy x∆∞∆°ng v√† n∆∞·ªõc d√πng ninh 24 ti·∫øng",
        price: "28.00",
        imageUrl: "https://images.unsplash.com/photo-1583394838336-acd977736f90?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[1].id,
        isAvailable: true,
        tags: ["signature", "premium", "wagyu"],
      },
      {
        name: "Grilled Lemongrass Beef",
        nameVi: "B√≤ N∆∞·ªõng S·∫£",
        description: "Charcoal-grilled beef marinated in lemongrass and spices, served with jasmine rice",
        descriptionVi: "Th·ªãt b√≤ n∆∞·ªõng than hoa ∆∞·ªõp s·∫£ v√† gia v·ªã, k√®m c∆°m d·∫ªo",
        price: "32.00",
        imageUrl: "https://images.unsplash.com/photo-1546833999-b9f581a1996d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[1].id,
        isAvailable: true,
        tags: ["grilled", "aromatic", "traditional"],
      },
      {
        name: "Clay Pot Fish with Caramel Sauce",
        nameVi: "C√° Kho T·ªô",
        description: "Fresh fish braised in clay pot with caramel sauce, galangal, and coconut water",
        descriptionVi: "C√° t∆∞∆°i kho t·ªô v·ªõi n∆∞·ªõc m√†u, ri·ªÅng v√† n∆∞·ªõc d·ª´a th∆°m ngon",
        price: "26.00",
        imageUrl: "https://images.unsplash.com/photo-1515003197210-e0cd71810b5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[1].id,
        isAvailable: true,
        tags: ["clay-pot", "sweet-savory", "coconut"],
      },
      {
        name: "Whole Roasted Duck",
        nameVi: "V·ªãt Quay Nguy√™n Con",
        description: "Five-spice roasted duck served with pancakes, cucumber, and hoisin sauce",
        descriptionVi: "V·ªãt quay ng≈© v·ªã th∆°m, k√®m b√°nh tr√°ng, d∆∞a chu·ªôt v√† t∆∞∆°ng ƒëen",
        price: "45.00",
        imageUrl: "https://images.unsplash.com/photo-1551218808-94e220e084d2?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[1].id,
        isAvailable: true,
        tags: ["premium", "whole-duck", "five-spice"],
      },

      // Desserts
      {
        name: "Vietnamese Coffee Tiramisu",
        nameVi: "Tiramisu C√† Ph√™ Vi·ªát",
        description: "Classic tiramisu infused with Vietnamese drip coffee and condensed milk",
        descriptionVi: "Tiramisu truy·ªÅn th·ªëng pha ch·∫ø v·ªõi c√† ph√™ phin Vi·ªát Nam v√† s·ªØa ƒë·∫∑c",
        price: "14.00",
        imageUrl: "https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[2].id,
        isAvailable: true,
        tags: ["coffee", "fusion", "creamy"],
      },
      {
        name: "Coconut Panna Cotta",
        nameVi: "Panna Cotta D·ª´a",
        description: "Silky coconut panna cotta with tropical fruit compote and toasted coconut flakes",
        descriptionVi: "Panna cotta d·ª´a m·ªãn m√†ng v·ªõi compote tr√°i c√¢y nhi·ªát ƒë·ªõi v√† d·ª´a n·∫°o rang",
        price: "12.00",
        imageUrl: "https://images.unsplash.com/photo-1488477181946-6428a0291777?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[2].id,
        isAvailable: true,
        tags: ["coconut", "silky", "tropical"],
      },

      // Tea Selection
      {
        name: "Premium Oolong Tea",
        nameVi: "Tr√† √î Long Cao C·∫•p",
        description: "Finest Vietnamese oolong tea with complex floral notes and natural sweetness",
        descriptionVi: "Tr√† √¥ long Vi·ªát Nam cao c·∫•p v·ªõi h∆∞∆°ng hoa tinh t·∫ø v√† v·ªã ng·ªçt t·ª± nhi√™n",
        price: "8.00",
        imageUrl: "https://images.unsplash.com/photo-1544787219-7f47ccb76574?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[3].id,
        isAvailable: true,
        tags: ["premium", "floral", "traditional"],
      },
      {
        name: "Jasmine Green Tea",
        nameVi: "Tr√† Xanh Hoa Nh√†i",
        description: "Delicate green tea scented with fresh jasmine flowers, served in traditional teapot",
        descriptionVi: "Tr√† xanh th∆°m nh·∫π v·ªõi hoa nh√†i t∆∞∆°i, ph·ª•c v·ª• trong ·∫•m tr√† truy·ªÅn th·ªëng",
        price: "6.00",
        imageUrl: "https://images.unsplash.com/photo-1544787219-7f47ccb76574?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
        categoryId: insertedCategories[3].id,
        isAvailable: true,
        tags: ["jasmine", "green-tea", "aromatic"],
      },
    ];

    await db.insert(menuItems).values(menuItemsData);
    console.log("‚úÖ Menu items seeded successfully");

    // Insert blog posts
    const blogPostsData = [
      {
        title: "The Art of Vietnamese Pho: A Culinary Journey",
        titleVi: "Ngh·ªá Thu·∫≠t N·∫•u Ph·ªü Vi·ªát Nam: H√†nh Tr√¨nh ·∫®m Th·ª±c",
        excerpt: "Discover the secrets behind our signature pho, from selecting the finest bones to achieving the perfect balance of spices in our 24-hour broth.",
        excerptVi: "Kh√°m ph√° b√≠ m·∫≠t ƒë·∫±ng sau t√¥ ph·ªü ƒë·∫∑c tr∆∞ng c·ªßa ch√∫ng t√¥i, t·ª´ vi·ªác ch·ªçn x∆∞∆°ng t·ªët nh·∫•t ƒë·∫øn c√¢n b·∫±ng ho√†n h·∫£o c√°c lo·∫°i gia v·ªã trong n∆∞·ªõc d√πng 24 ti·∫øng.",
        content: "The art of making authentic Vietnamese pho is a testament to patience, tradition, and culinary expertise. At Noir Cuisine, we honor this ancient craft while elevating it to new heights...",
        contentVi: "Ngh·ªá thu·∫≠t n·∫•u ph·ªü Vi·ªát Nam ch√≠nh g·ªëc l√† minh ch·ª©ng cho s·ª± ki√™n nh·∫´n, truy·ªÅn th·ªëng v√† chuy√™n m√¥n ·∫©m th·ª±c. T·∫°i Noir Cuisine, ch√∫ng t√¥i t√¥n vinh ngh·ªÅ th·ªß c√¥ng c·ªï x∆∞a n√†y...",
        imageUrl: "https://images.unsplash.com/photo-1583394838336-acd977736f90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
        published: true,
      },
      {
        title: "Seasonal Menu: Spring Harvest Collection",
        titleVi: "Th·ª±c ƒê∆°n Theo M√πa: B·ªô S∆∞u T·∫≠p M√πa Xu√¢n",
        excerpt: "Experience the freshness of spring with our new seasonal menu featuring the finest local ingredients and traditional Vietnamese cooking techniques.",
        excerptVi: "Tr·∫£i nghi·ªám s·ª± t∆∞∆°i m·ªõi c·ªßa m√πa xu√¢n v·ªõi th·ª±c ƒë∆°n theo m√πa m·ªõi c·ªßa ch√∫ng t√¥i, v·ªõi nh·ªØng nguy√™n li·ªáu ƒë·ªãa ph∆∞∆°ng t·ªët nh·∫•t v√† k·ªπ thu·∫≠t n·∫•u ƒÉn truy·ªÅn th·ªëng Vi·ªát Nam.",
        content: "Spring brings renewal and fresh beginnings, and our kitchen celebrates this season with a carefully curated menu that showcases the best of Vietnamese cuisine...",
        contentVi: "M√πa xu√¢n mang ƒë·∫øn s·ª± ƒë·ªïi m·ªõi v√† kh·ªüi ƒë·∫ßu t∆∞∆°i m·ªõi, v√† nh√† b·∫øp c·ªßa ch√∫ng t√¥i ch√†o m·ª´ng m√πa n√†y v·ªõi th·ª±c ƒë∆°n ƒë∆∞·ª£c tuy·ªÉn ch·ªçn k·ªπ l∆∞·ª°ng...",
        imageUrl: "https://images.unsplash.com/photo-1551632436-cbf8dd35adfa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
        published: true,
      },
      {
        title: "Behind the Scenes: Meet Chef Minh's Culinary Philosophy",
        titleVi: "H·∫≠u Tr∆∞·ªùng: G·∫∑p G·ª° Tri·∫øt L√Ω ·∫®m Th·ª±c C·ªßa ƒê·∫ßu B·∫øp Minh",
        excerpt: "Get an intimate look into the mind of our executive chef and discover how traditional Vietnamese values shape our modern culinary approach.",
        excerptVi: "C√≥ c√°i nh√¨n s√¢u s·∫Øc v·ªÅ t√¢m h·ªìn c·ªßa ƒë·∫ßu b·∫øp tr∆∞·ªüng v√† kh√°m ph√° c√°ch c√°c gi√° tr·ªã truy·ªÅn th·ªëng Vi·ªát Nam ƒë·ªãnh h√¨nh ph∆∞∆°ng ph√°p ·∫©m th·ª±c hi·ªán ƒë·∫°i c·ªßa ch√∫ng t√¥i.",
        content: "Chef Minh's journey from the streets of Saigon to the refined dining rooms of Noir Cuisine is a story of passion, dedication, and unwavering commitment to culinary excellence...",
        contentVi: "H√†nh tr√¨nh c·ªßa ƒê·∫ßu b·∫øp Minh t·ª´ nh·ªØng con ph·ªë S√†i G√≤n ƒë·∫øn ph√≤ng ƒÉn sang tr·ªçng c·ªßa Noir Cuisine l√† c√¢u chuy·ªán v·ªÅ ƒëam m√™, s·ª± c·ªëng hi·∫øn v√† cam k·∫øt kh√¥ng lay chuy·ªÉn...",
        imageUrl: "https://images.unsplash.com/photo-1577219491135-ce391730fb2c?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
        published: true,
      },
    ];

    await db.insert(blogPosts).values(blogPostsData);
    console.log("‚úÖ Blog posts seeded successfully");

    // Create admin and staff users (with conflict handling)
    try {
      await db.insert(users).values([
        {
          username: "admin",
          email: "admin@noircuisine.vn",
          password: "admin123", // In real app, this should be hashed
          role: "admin",
          fullName: "Administrator",
          isActive: true,
        },
        {
          username: "staff",
          email: "staff@noircuisine.vn",
          password: "staff123", // In real app, this should be hashed
          role: "staff",
          fullName: "Staff Member",
          permissions: ["view_orders", "view_reservations"],
          isActive: true,
        }
      ]);
      console.log("‚úÖ Users seeded successfully");
    } catch (error: any) {
      if (error.code === '23505') {
        console.log("‚úÖ Users already exist, skipping user creation");
      } else {
        throw error;
      }
    }

    console.log("üéâ Database seeding completed successfully!");

  } catch (error) {
    console.error("‚ùå Error seeding database:", error);
    throw error;
  }
}

// Run the seed function
seedData()
  .then(() => {
    console.log("Seeding completed, exiting...");
    process.exit(0);
  })
  .catch((error) => {
    console.error("Seeding failed:", error);
    process.exit(1);
  });